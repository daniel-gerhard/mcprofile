<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • mcprofile</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mcprofile</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/mcprofile.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1></h1>
            
          </div>

    
    
<div class="contents">
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{An introduction to the mcprofile package}
-->
<div id="an-introduction-to-the-mcprofile-package" class="section level1">
<h1 class="hasAnchor">
<a href="#an-introduction-to-the-mcprofile-package" class="anchor"></a>An introduction to the mcprofile package</h1>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>The package mcprofile contains functions for simultaneous inference based on a set of profile statistics, controlling the family-wise error rate (FWER) at a specified level. Focus is set on testing general linear hypotheses in generalized linear models and provide a set of compatible simultaneous confidence intervals. The multiple testing framework of Hothorn et al. (2008) is adopted to signed likelihood root and modified likelihood root statistics to improve the performance especially at small sample sizes.</p>
</div>
<div id="methods" class="section level2">
<h2 class="hasAnchor">
<a href="#methods" class="anchor"></a>Methods</h2>
<div id="generalized-linear-models" class="section level3">
<h3 class="hasAnchor">
<a href="#generalized-linear-models" class="anchor"></a>Generalized linear models</h3>
<p>A vector of <span class="math inline">\(i=1,\dots,n\)</span> observations <span class="math inline">\(y_{i}\)</span> is assumed to be a realization of a random variable <span class="math inline">\(Y_{i}\)</span>, where each component of <span class="math inline">\(Y_{i}\)</span> is assumed to have a distribution in the exponential family. The systematic component of the assumed generalized linear model is <span class="math display">\[ g(\mu_{i}) = \eta_{i} = \sum_{j=1}^{p} x_{ij} \beta_{j}  \]</span> with a link function <span class="math inline">\(g(\cdot)\)</span>, a <span class="math inline">\(p\)</span>-dimensional vector of parameters <span class="math inline">\(\beta_{j}\)</span>, and a <span class="math inline">\((n \times p)\)</span> matrix with design covariates <span class="math inline">\(x_{ij}\)</span>. Thus, the log-likelihood can be written as <span class="math inline">\(l(\mu_{i}; y_{i}) = \sum_{i=1}^{n} \log f_{i}(y_{i}; \mu_{i})\)</span>. Instead of the likelihood function, the scaled deviance <span class="math display">\[ D(y_{i}; \mu_{i}) = 2l(y_{i}; y_{i}) - 2l(\mu_{i}; y_{i}) \]</span> can be used as a goodness-of-fit criterion. To estimate a coefficient vector <span class="math inline">\(\hat{\beta}_{j}\)</span> an iteratively re-weighted least squares algorithm is applied for finding the minimum of the deviance function. A more detailed introduction can be found in McCullagh and Nelder (1989).</p>
</div>
<div id="general-linear-hypotheses" class="section level3">
<h3 class="hasAnchor">
<a href="#general-linear-hypotheses" class="anchor"></a>General linear hypotheses</h3>
<p>In many applications the experimental questions are specified through <span class="math inline">\(k=1,\dots,q\)</span> linear combinations of the model parameters, <span class="math inline">\(\vartheta_{k} = \sum_{j=1}^{p} a_{kj}\beta_{j}\)</span>, which are defined by a <span class="math inline">\((q \times p)\)</span> coefficient matrix <span class="math inline">\(a_{kj}\)</span>. When constructing simultaneous confidence intervals or hypotheses tests, the multiple comparison problem of testing all hypotheses at a nominal level of <span class="math inline">\(\alpha\)</span>, the overall type I error rate, has to be considered. A unifying simultaneous inference framework for these parameter linear combinations in general parametric models is presented in Hothorn et al. (2008). They consider the general linear hypotheses: <span class="math display">\[ H_{0}: \quad \sum_{j=1}^{p} a_{kj}\beta_{j} = m_{k} \]</span> where <span class="math inline">\(m_{k}\)</span> is a vector, of order <span class="math inline">\(q\)</span>, of specified constants.</p>
<p>The key factor of this single-step inference is the assumption of a multivariate normal-distribution of the standardized estimator <span class="math inline">\(\hat{\vartheta}_{k}\)</span> with a correlation structure, which is directly obtained from the <span class="math inline">\((p \times p)\)</span> observed information matrix at the parameter estimates <span class="math inline">\(j(\beta)=-\frac{\partial^{2}l(\mu_{i}; y_{i})}{\partial \beta \partial \beta^{T}}\)</span>.</p>
</div>
<div id="profile-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#profile-statistics" class="anchor"></a>Profile statistics</h3>
<p>Several test statistics can be used to test the set of general linear hypotheses [Brazzale and Davison, 2008].</p>
<div id="wald-statistic" class="section level4">
<h4 class="hasAnchor">
<a href="#wald-statistic" class="anchor"></a>Wald statistic</h4>
<p><span class="math display">\[ w(\vartheta_{k}) = \left( \hat{\vartheta}_{k} - \vartheta_{k} \right) j^{\frac{1}{2}}(\hat{\vartheta}_{k}), \]</span></p>
<p>where <span class="math inline">\(j^{-1}(\hat{\vartheta}) = Aj^{-1}(\hat{\beta})A^{T}\)</span> is the observed information matrix of the contrast parameters, with <span class="math inline">\(A\)</span> being the <span class="math inline">\((q \times p)\)</span> coefficient matrix with elements <span class="math inline">\(a_{kj}\)</span>. As <span class="math inline">\(\hat{\vartheta}_{k}\)</span> and the observed information are fixed at the maximum likelihood estimates, <span class="math inline">\(w(\vartheta_{k})\)</span> is a linear function with increasing <span class="math inline">\(\vartheta_{k}\)</span>, and therefore approximates the deviance by a quadratic function <span class="math inline">\(w(\vartheta_{k})^2\)</span>, which holds exactly for a Gaussian linear model.</p>
</div>
<div id="signed-likelihood-root" class="section level4">
<h4 class="hasAnchor">
<a href="#signed-likelihood-root" class="anchor"></a>Signed likelihood root</h4>
<p><span class="math display">\[ q(\vartheta_{k}) = sign \left( \hat{\vartheta}_{k} - \vartheta_{k} \right) \sqrt{\frac{D(y_{i}; \hat{\mu}_{i}) - D(y_{i}; \tilde{\mu}_{i})}{\phi}} \]</span></p>
<p><span class="math inline">\(\hat{\mu}_{i}\)</span> is the linear predictor at the maximum likelihood estimates <span class="math inline">\(\hat{\beta}_{j}\)</span>. <span class="math inline">\(\tilde{\mu}_{i}\)</span> denotes the linear predictor obtained for restricted parameter estimates <span class="math inline">\(\tilde{\beta}_{j}\)</span>, obtained under the <span class="math inline">\(k\)</span>th linear constraint <span class="math inline">\(\sum_{j=1}^{p} a_{kj}\beta_{j} = \vartheta_{k}\)</span>. <span class="math inline">\(\phi\)</span> is a dispersion parameter, which accounts for extra variation in the data. This parameter is fixed at 1 e.g. for a Binomial or Poisson model, but can also be estimated from the data, like the residual error in a Gaussian linear model.</p>
<p>To obtain <span class="math inline">\(\tilde{\mu}_{i}\)</span>, the weighted least squares step in the IRWLS algorithm can be modified by using a weighted regression of <span class="math inline">\(z\)</span> on the design covariates <span class="math inline">\(x_{1},\dots,x_{p}\)</span> with weight <span class="math inline">\(W\)</span>, which allows to apply linear equality constraints on the regression parameters at each iteration. A quadratic programming algorithm, mcprofile uses function <em>solve.QP()</em> in package <em>quadprog</em>, can be used to obtain the restricted parameter estimates.</p>
</div>
<div id="modified-likelihood-root" class="section level4">
<h4 class="hasAnchor">
<a href="#modified-likelihood-root" class="anchor"></a>Modified likelihood root</h4>
<p><span class="math display">\[ r(\vartheta_{k}) = q(\vartheta_{k}) + \frac{1}{q(\vartheta_{k})} \log \left( \frac{w(\vartheta_{k})\rho(\vartheta_{k}, \hat{\vartheta}_{k})}{q(\vartheta_{k})} \right), \]</span></p>
<p>with <span class="math inline">\(\rho(\vartheta_{k}, \hat{\vartheta}_{k}) = \sqrt{\frac{|j_{\lambda \lambda}(\hat{\beta}_{j})|}{|j_{\lambda \lambda}(\tilde{\beta}_{j})|}}\)</span>. <span class="math inline">\(|j_{\lambda\lambda}(\cdot)|\)</span> denotes the determinant of a subset of the observed information matrix to summarize the information about the nuisance parameters that are not subject to the linear constraint. The observed information is evaluated at the maximum likelihood estimates <span class="math inline">\(\hat{\beta}_{j}\)</span> and the restricted estimates <span class="math inline">\(\tilde{\beta}_{j}\)</span> under the linear constraint <span class="math inline">\(\sum_{j=1}^{p} a_{kj}\beta_{j} = \vartheta_{k}\)</span>.</p>
</div>
</div>
<div id="confidence-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#confidence-intervals" class="anchor"></a>Confidence intervals</h3>
<p>A Wald-type confidence interval is defined as <span class="math display">\[ I = \left\{ \vartheta_{k}: -c_{1-\alpha} \leq w(\vartheta_{k}) \leq c_{1-\alpha} \right\} \]</span></p>
<p>with a critical value <span class="math inline">\(c_{1-\alpha}\)</span>. Analogously, <span class="math inline">\(w(\vartheta_{k})\)</span> can be substituted by the different profile statistics <span class="math inline">\(q(\vartheta_{k})\)</span> and <span class="math inline">\(r(\vartheta_{k})\)</span>. As the confidence limits are found separately for each of the <span class="math inline">\(q\)</span> linear combinations of parameters, the combined set of confidence limits describes a rectangular confidence set in a <span class="math inline">\(q\)</span>-dimensional space.</p>
<p>The critical value should be chosen in a way that the FWER is controlled, considering the correlation between the derived parameters. The statistics are assumed to follow a <span class="math inline">\(q\)</span>-variate normal or <span class="math inline">\(t\)</span>-distribution. The correlation structure for this distribution is obtained by standardizing the variance-covariance matrix of the contrast parameters, <span class="math display">\[ \Phi(\hat{\vartheta}) =  \Delta(\hat{\vartheta}_{k}) j^{-1}(\hat{\vartheta}) \Delta(\hat{\vartheta}_{k}), \qquad  \Delta(\hat{\vartheta}_{k}) = j^{\frac{1}{2}}(\hat{\vartheta}_{k})I_{q}, \]</span> using the estimates from the data and treat them as if it were the true correlation matrix. In order to assign the same weight or error level to each of the <span class="math inline">\(q\)</span> hypotheses an equicoordinate quantile <span class="math inline">\(c_{1-\alpha}\)</span> is calculated from this <span class="math inline">\(q\)</span>-dimensional distribution. The package mvtnorm is used to compute the quantile.</p>
<p>For an effective search for the confidence limits, a grid of values for each of the <span class="math inline">\(\theta_{k}\)</span> around the maximum likelihood estimates is established, interpolating the resulting <span class="math inline">\(q(\vartheta_{k})\)</span> or <span class="math inline">\(r(\vartheta_{k})\)</span> by a cubic spline function. The confidence limits are found by evaluating the inverse of this interpolating function at <span class="math inline">\(-c_{1-\alpha}\)</span> and <span class="math inline">\(c_{1-\alpha}\)</span>.</p>
</div>
<div id="multiple-hypotheses-testing" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-hypotheses-testing" class="anchor"></a>Multiple hypotheses testing</h3>
<p>Instead of simultaneous confidence intervals, the analogue testing procedure of the set of null hypotheses <span class="math inline">\(H_{0}: \; \vartheta_{k}=m_{k}\)</span> is available. To maintain the FWER, the global null hypothesis is rejected, if at least one elementary hypothesis is rejected; thus, focus is set on the maximum of test statistics. The distribution of this maximum evaluated at the specific test margins <span class="math inline">\(m_{k}\)</span> can be specified for a two-sided testing procedure as <span class="math display">\[ P(\max \left| w(m_{k}) \right| \leq t) = g(\Phi(\hat{\vartheta}), t) \]</span> for any <span class="math inline">\(t \in \mathbb{R}\)</span>. Adjusted p-values controlling the FWER are calculated as <span class="math display">\[ p_{k} = 1-g(\Phi(\hat{\vartheta}), \left| t_{k} \right|) \]</span> where <span class="math inline">\(t_{k}\)</span> is the observed statistic, either using <span class="math inline">\(w(\cdot)\)</span>, <span class="math inline">\(q(\cdot)\)</span>, or <span class="math inline">\(r(\cdot)\)</span>.</p>
</div>
</div>
<div id="the-mcprofile-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-mcprofile-function" class="anchor"></a>The mcprofile() function</h2>
<p>The mcprofile function needs at least two components, an object of class glm and a contrast matrix to define several linear combinations of glm coefficients.</p>
<p>As an application example the cta dataset is used, where Balb/c 3T3 cells are treated with different concentrations of a carcinogen to test for toxicity. Cells treated with a carcinogen do not stop proliferation, hence the number of foci (cell accumulations) are used as a measure of toxicity. The number of foci is counted for 10 indipendent replicates per concentration level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(cta)
<span class="kw">str</span>(cta)</code></pre></div>
<pre><code>## 'data.frame':    80 obs. of  2 variables:
##  $ conc: num  0 0 0 0 0 0 0 0 0 0 ...
##  $ foci: int  0 1 0 0 0 0 0 0 0 2 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cta<span class="op">$</span>concf &lt;-<span class="st"> </span><span class="kw">factor</span>(cta<span class="op">$</span>conc, <span class="dt">levels=</span><span class="kw">unique</span>(cta<span class="op">$</span>conc))

<span class="kw">ggplot</span>(cta, <span class="kw">aes</span>(<span class="dt">y=</span>foci, <span class="dt">x=</span>concf)) <span class="op">+</span><span class="st"> </span>
<span class="st">   </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_dotplot</span>(<span class="dt">binaxis =</span> <span class="st">"y"</span>, <span class="dt">stackdir =</span> <span class="st">"center"</span>, <span class="dt">binwidth =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st">    </span>
<span class="st">   </span><span class="kw">xlab</span>(<span class="st">"concentration"</span>)</code></pre></div>
<p><img src="mcprofile_files/figure-html/ctadata-1.png" width="672"></p>
<p>In a first analysis, the distance between dose levels is not taken into account, comparing the expectated values for each dose levels with the one of the control. A generalized linear model is fitted to the data, assuming that the number of foci is following a Poisson distribution.</p>
<p><span class="math display">\[ y_{i} \sim Poisson(\mu_{i}), \qquad \log(\mu_{i}) = \eta_{i}, \qquad \eta_{i} = \beta_{0} + \sum_{j=1}^{7} x_{ij}\beta_{j} \]</span></p>
<p>The dummy covariates <span class="math inline">\(x_{ij}\)</span> are chosen in a way, that the <span class="math inline">\(\beta_{j}\)</span> represent differences of each dose levels to the intercept <span class="math inline">\(\beta_{0}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(m1 &lt;-<span class="st"> </span><span class="kw">glm</span>(foci <span class="op">~</span><span class="st"> </span>concf, <span class="dt">data=</span>cta, <span class="dt">family=</span><span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">"log"</span>)))</code></pre></div>
<pre><code>## 
## Call:  glm(formula = foci ~ concf, family = poisson(link = "log"), data = cta)
## 
## Coefficients:
## (Intercept)    concf0.01    concf0.03     concf0.1     concf0.3  
##     -1.2040       0.5108      -0.4055       1.3863       2.1595  
##      concf1       concf3      concf10  
##      2.7300       2.8134       2.9789  
## 
## Degrees of Freedom: 79 Total (i.e. Null);  72 Residual
## Null Deviance:       272.2 
## Residual Deviance: 106   AIC: 282.9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># confidence intervals for beta_j</span>
<span class="kw">confint</span>(m1, <span class="dt">parm=</span><span class="dv">2</span><span class="op">:</span><span class="dv">8</span>)</code></pre></div>
<pre><code>##                2.5 %   97.5 %
## concf0.01 -0.8941688 2.095110
## concf0.03 -2.4325964 1.392205
## concf0.1   0.2396109 2.865485
## concf0.3   1.1159257 3.593120
## concf1     1.7257778 4.145704
## concf3     1.8132747 4.227184
## concf10    1.9860194 4.389347</code></pre>
<p>The same confidence intervals can be reproduced with mcprofile, but using linear contrasts instead of the parms argument. With the contrast matrix a linear combination of model coefficients is defined in each row; hence in each row the coefficient of 1 refers to the position of the <span class="math inline">\(\beta_{j}\)</span> in the coefficient vector of the glm object. Names are passed down from the rownmaes of the contrast matrix.</p>
<p>Based on the profiles of the likelihood root, confidence intervals are calculated with the argument <em>adjust=“none”</em> to control the per comparison error rate with a separate type-I-error for each comparison.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cm1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">0</span>, <span class="kw">diag</span>(<span class="dv">7</span>))
<span class="kw">rownames</span>(cm1) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">levels</span>(cta<span class="op">$</span>concf)[<span class="op">-</span><span class="dv">1</span>], <span class="kw">levels</span>(cta<span class="op">$</span>concf)[<span class="dv">1</span>], <span class="dt">sep=</span><span class="st">" - "</span>)
<span class="kw">print</span>(cm1)</code></pre></div>
<pre><code>##          [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
## 0.01 - 0    0    1    0    0    0    0    0    0
## 0.03 - 0    0    0    1    0    0    0    0    0
## 0.1 - 0     0    0    0    1    0    0    0    0
## 0.3 - 0     0    0    0    0    1    0    0    0
## 1 - 0       0    0    0    0    0    1    0    0
## 3 - 0       0    0    0    0    0    0    1    0
## 10 - 0      0    0    0    0    0    0    0    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcprofile.html">mcprofile</a></span>(m1, cm1)
<span class="kw">confint</span>(p1, <span class="dt">adjust=</span><span class="st">"none"</span>)</code></pre></div>
<pre><code>## 
##    mcprofile - Confidence Intervals 
## 
## level:        0.95 
## adjustment:   none 
## 
##          Estimate  lower upper
## 0.01 - 0    0.511 -0.894  2.09
## 0.03 - 0   -0.405 -2.432  1.39
## 0.1 - 0     1.386  0.240  2.87
## 0.3 - 0     2.159  1.116  3.59
## 1 - 0       2.730  1.726  4.15
## 3 - 0       2.813  1.813  4.23
## 10 - 0      2.979  1.986  4.39</code></pre>
<p>Instead of directly estimating the difference to the control, the coefficient vector can be reparameterized to represent the (log-) expected values for each concentration level by omitting the intercept in the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(m2 &lt;-<span class="st"> </span><span class="kw">glm</span>(foci <span class="op">~</span><span class="st"> </span>concf<span class="op">-</span><span class="dv">1</span>, <span class="dt">data=</span>cta, <span class="dt">family=</span><span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">"log"</span>)))</code></pre></div>
<pre><code>## 
## Call:  glm(formula = foci ~ concf - 1, family = poisson(link = "log"), 
##     data = cta)
## 
## Coefficients:
##    concf0  concf0.01  concf0.03   concf0.1   concf0.3     concf1  
##   -1.2040    -0.6931    -1.6094     0.1823     0.9555     1.5261  
##    concf3    concf10  
##    1.6094     1.7750  
## 
## Degrees of Freedom: 80 Total (i.e. Null);  72 Residual
## Null Deviance:       404.3 
## Residual Deviance: 106   AIC: 282.9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># m1 and m2 are the same models with different parameterization</span>
<span class="kw">all.equal</span>(<span class="kw">deviance</span>(m1), <span class="kw">deviance</span>(m2))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The definition of a contrast matrix in mcprofile allows also to compute the same confidence intervals for the difference of concentration levels to the control, similar to the confidence intervals of the first modeling approach. The functionality of the package multcomp with the <em>contrMat</em> function can be used to use several pre-defined structures for the contrast matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(multcomp)
(cm2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/multcomp/topics/contrMat">contrMat</a></span>(<span class="kw">table</span>(cta<span class="op">$</span>concf), <span class="dt">type=</span><span class="st">"Dunnett"</span>))</code></pre></div>
<pre><code>## 
##   Multiple Comparisons of Means: Dunnett Contrasts
## 
##           0 0.01 0.03 0.1 0.3 1 3 10
## 0.01 - 0 -1    1    0   0   0 0 0  0
## 0.03 - 0 -1    0    1   0   0 0 0  0
## 0.1 - 0  -1    0    0   1   0 0 0  0
## 0.3 - 0  -1    0    0   0   1 0 0  0
## 1 - 0    -1    0    0   0   0 1 0  0
## 3 - 0    -1    0    0   0   0 0 1  0
## 10 - 0   -1    0    0   0   0 0 0  1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcprofile.html">mcprofile</a></span>(m2, cm2)
(ci &lt;-<span class="st"> </span><span class="kw">confint</span>(p2, <span class="dt">adjust=</span><span class="st">"none"</span>))</code></pre></div>
<pre><code>## 
##    mcprofile - Confidence Intervals 
## 
## level:        0.95 
## adjustment:   none 
## 
##          Estimate  lower upper
## 0.01 - 0    0.511 -0.894  2.09
## 0.03 - 0   -0.405 -2.432  1.39
## 0.1 - 0     1.386  0.240  2.87
## 0.3 - 0     2.159  1.116  3.59
## 1 - 0       2.730  1.726  4.15
## 3 - 0       2.813  1.813  4.23
## 10 - 0      2.979  1.986  4.39</code></pre>
<div id="plot-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-methods" class="anchor"></a>plot methods</h3>
<p>The plot functionality in mcprofile is based on the package ggplot2. The calculated profiles can simply be plotted by calling plot. The ggplot2 function <em>ylim</em> is used to restrict the y-axis scale to a range <span class="math inline">\([-5,5]\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(p2) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>))</code></pre></div>
<p><img src="mcprofile_files/figure-html/plot1-1.png" width="672"></p>
<p>A visualization of the confidence intervals can be obtained by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ci)</code></pre></div>
<p><img src="mcprofile_files/figure-html/plot2-1.png" width="672"></p>
<p>The confidence intervals are shown on the scale of the linear predictor. The mcprofile package contains an <em>exp</em> method to transform the scale. Further ggplot2 functions can be used to change the plot layout.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">exp</span>(ci)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_trans</span>(<span class="dt">x=</span><span class="st">"log"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="mcprofile_files/figure-html/plot3-1.png" width="672"></p>
</div>
<div id="modifying-the-profile-support-grid" class="section level3">
<h3 class="hasAnchor">
<a href="#modifying-the-profile-support-grid" class="anchor"></a>Modifying the profile support grid</h3>
<p>As the default, the grid with support points, for which contrast coefficient values the profile statistics are calculated, is defined automatically. With the argument , a matrix with support points in each column defines the sequence of points in the parameter space of the contrast parameters defined in each row of the contrast matrix.</p>
<p>For example, the profiles can be calculated for a range of 15 support values between <span class="math inline">\([-3, 5]\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cgrid &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(cm2), <span class="cf">function</span>(i) <span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">5</span>, <span class="dt">length=</span><span class="dv">15</span>))
<span class="kw">head</span>(cgrid)</code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]
## [1,] -3.0000000 -3.0000000 -3.0000000 -3.0000000 -3.0000000 -3.0000000
## [2,] -2.4285714 -2.4285714 -2.4285714 -2.4285714 -2.4285714 -2.4285714
## [3,] -1.8571429 -1.8571429 -1.8571429 -1.8571429 -1.8571429 -1.8571429
## [4,] -1.2857143 -1.2857143 -1.2857143 -1.2857143 -1.2857143 -1.2857143
## [5,] -0.7142857 -0.7142857 -0.7142857 -0.7142857 -0.7142857 -0.7142857
## [6,] -0.1428571 -0.1428571 -0.1428571 -0.1428571 -0.1428571 -0.1428571
##            [,7]
## [1,] -3.0000000
## [2,] -2.4285714
## [3,] -1.8571429
## [4,] -1.2857143
## [5,] -0.7142857
## [6,] -0.1428571</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcprofile.html">mcprofile</a></span>(m2, cm2, <span class="dt">grid=</span>cgrid)
<span class="kw">plot</span>(p3) </code></pre></div>
<p><img src="mcprofile_files/figure-html/grid-1.png" width="672"></p>
</div>
<div id="simultaneous-confidence-intervals-and-multiple-testing" class="section level3">
<h3 class="hasAnchor">
<a href="#simultaneous-confidence-intervals-and-multiple-testing" class="anchor"></a>Simultaneous confidence intervals and multiple testing</h3>
<p>The default, when using the  function, is to adjust for multiplicity by a single-step method, calculating a quantile of a multivariate normal or <em>t</em>-distribution. As an alternative the multiplicity adjustment by the Bonferroni method is available.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ci2 &lt;-<span class="st"> </span><span class="kw">confint</span>(p2, <span class="dt">adjust=</span><span class="st">"single-step"</span>))</code></pre></div>
<pre><code>## 
##    mcprofile - Confidence Intervals 
## 
## level:        0.95 
## adjustment:   single-step 
## 
##          Estimate   lower upper
## 0.01 - 0    0.511 -1.2492  2.55
## 0.03 - 0   -0.405 -3.0523  1.87
## 0.1 - 0     1.386 -0.0175  3.31
## 0.3 - 0     2.159  0.8959  4.04
## 1 - 0       2.730  1.5192  4.59
## 3 - 0       2.813  1.6081  4.67
## 10 - 0      2.979  1.7833  4.83</code></pre>
<p>Compatible tests are available with the <em>summary</em> method. Here, further multiple testing adjustment is available through the function . A single test margin can be specified to define the Null-hypotheses together with a test direction. A test if the difference of the average log-number of foci is larger than 1 for any concentration level compared to the control can be calculated by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(p2, <span class="dt">margin=</span><span class="dv">1</span>, <span class="dt">alternative=</span><span class="st">"greater"</span>)</code></pre></div>
<pre><code>## 
##    mcprofile - Multiple Testing
## 
## Adjustment:   single-step 
## Margin:       1 
## Alternative:  greater 
## 
##               Estimate Statistic Pr(&gt;z)    
## 0.01 - 0 &lt;= 1     0.51     -0.65  0.924    
## 0.03 - 0 &lt;= 1    -0.41     -1.55  0.993    
## 0.1 - 0 &lt;= 1      1.39      0.62  0.507    
## 0.3 - 0 &lt;= 1      2.16      2.21  0.043 *  
## 1 - 0 &lt;= 1        2.73      3.76 &lt;1e-04 ***
## 3 - 0 &lt;= 1        2.81      4.02 &lt;1e-04 ***
## 10 - 0 &lt;= 1       2.98      4.56 &lt;1e-04 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div id="wald-type-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#wald-type-statistics" class="anchor"></a>Wald-type statistics</h2>
<p>Instead of the likelihood root, the Wald-type statistic can be used to construct a profile. The function <em>wald</em> directly transforms the profile object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">w2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/wald.html">wald</a></span>(p2)
<span class="kw">plot</span>(w2) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>))</code></pre></div>
<p><img src="mcprofile_files/figure-html/wald-1.png" width="672"></p>
<p>The simultaneous confidence intervals are exactly the same as the ones obtained with the function <em>glht</em> in package multcomp.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/multcomp/topics/glht">glht</a></span>(m2, cm2))</code></pre></div>
<pre><code>## 
##   Simultaneous Confidence Intervals
## 
## Multiple Comparisons of Means: Dunnett Contrasts
## 
## 
## Fit: glm(formula = foci ~ concf - 1, family = poisson(link = "log"), 
##     data = cta)
## 
## Quantile = 2.4375
## 95% family-wise confidence level
##  
## 
## Linear Hypotheses:
##               Estimate lwr     upr    
## 0.01 - 0 == 0  0.5108  -1.2693  2.2909
## 0.03 - 0 == 0 -0.4055  -2.6306  1.8197
## 0.1 - 0 == 0   1.3863  -0.1871  2.9597
## 0.3 - 0 == 0   2.1595   0.6732  3.6458
## 1 - 0 == 0     2.7300   1.2776  4.1825
## 3 - 0 == 0     2.8134   1.3645  4.2623
## 10 - 0 == 0    2.9789   1.5363  4.4216</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(w2)</code></pre></div>
<pre><code>## 
##    mcprofile - Confidence Intervals 
## 
## level:        0.95 
## adjustment:   single-step 
## 
##          Estimate  lower upper
## 0.01 - 0    0.511 -1.270  2.29
## 0.03 - 0   -0.405 -2.631  1.82
## 0.1 - 0     1.386 -0.188  2.96
## 0.3 - 0     2.159  0.673  3.65
## 1 - 0       2.730  1.277  4.18
## 3 - 0       2.813  1.364  4.26
## 10 - 0      2.979  1.536  4.42</code></pre>
</div>
<div id="modified-likelihood-root-1" class="section level2">
<h2 class="hasAnchor">
<a href="#modified-likelihood-root-1" class="anchor"></a>Modified likelihood root</h2>
<p>At small sample sizes, the likelihood root statistic can be exchanged with the modified likelihood root to improve the performance of the confidence intervals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hoa.html">hoa</a></span>(p2)
<span class="kw">confint</span>(h2)</code></pre></div>
<pre><code>## 
##    mcprofile - Confidence Intervals 
## 
## level:        0.95 
## adjustment:   single-step 
## 
##          Estimate   lower upper
## 0.01 - 0    0.511 -1.2537  2.50
## 0.03 - 0   -0.405 -2.9585  1.86
## 0.1 - 0     1.386 -0.0429  3.23
## 0.3 - 0     2.159  0.8656  3.95
## 1 - 0       2.730  1.4876  4.49
## 3 - 0       2.813  1.5764  4.57
## 10 - 0      2.979  1.7514  4.73</code></pre>
</div>
<div id="simultaneous-confidence-intervals-for-predictions-in-logistic-regression-models" class="section level2">
<h2 class="hasAnchor">
<a href="#simultaneous-confidence-intervals-for-predictions-in-logistic-regression-models" class="anchor"></a>Simultaneous confidence intervals for predictions in logistic regression models</h2>
<p>As a more advanced example, point-wise simultaneous confidence bands are computed based on a logistic regression model. In a dose-response experiment the lethal effect of an insecticide is tested. The data example is artificially generated, based on an excerpt of a real experiment, assuming very small sample sizes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(toxinLD)
toxinLD<span class="op">$</span>logdose &lt;-<span class="st"> </span><span class="kw">log</span>(toxinLD<span class="op">$</span>dose)
<span class="kw">ggplot</span>(toxinLD, <span class="kw">aes</span>(<span class="dt">x=</span>logdose, <span class="dt">y=</span>dead<span class="op">/</span>(dead<span class="op">+</span>alive))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="mcprofile_files/figure-html/toxin-1.png" width="672"></p>
<p>The dose-response curve is modeled by a logistic regression model with <span class="math display">\[ y_{i} \sim Binomial(n_{i}, \mu_{i}), \qquad \eta_{i} = \log \left( \frac{\mu_{i}}{1-\mu_{i}} \right), \qquad \eta_{i} = \beta_{1} + \log (x_{i}) \beta_{2}. \]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mlr &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">cbind</span>(dead, alive) <span class="op">~</span><span class="st"> </span>logdose, <span class="dt">data=</span>toxinLD, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">"logit"</span>))</code></pre></div>
<p>The transformed parameters <span class="math inline">\(\vartheta_{k} = \sum_{j=1}^{p} a_{kj}\beta_{j}\)</span> are representing predictions for prespecified dose levels <span class="math inline">\(a_{k2}\)</span> and intercept design coefficients <span class="math inline">\(a_{k1}\)</span>. Predictions should be made for 20 logarithmic dose values between <span class="math inline">\([-1,2.3]\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pdose &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>,<span class="fl">2.3</span>, <span class="dt">length=</span><span class="dv">7</span>)
cmlr &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span><span class="st"> </span>pdose)
<span class="kw">rownames</span>(cmlr) &lt;-<span class="st"> </span><span class="kw">round</span>(pdose, <span class="dv">2</span>)
<span class="kw">head</span>(cmlr)</code></pre></div>
<pre><code>##       (Intercept) pdose
## -1              1 -1.00
## -0.45           1 -0.45
## 0.1             1  0.10
## 0.65            1  0.65
## 1.2             1  1.20
## 1.75            1  1.75</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mcprofile.html">mcprofile</a></span>(mlr, cmlr)
cilr &lt;-<span class="st"> </span><span class="kw">confint</span>(plr)

<span class="kw">plot</span>(cilr) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"logit(mu)"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"log dose level"</span>)</code></pre></div>
<p><img src="mcprofile_files/figure-html/lrcm-1.png" width="672"></p>
<p>The confidence bands can be presented in a graphic as a shaded area around the predicted curve.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pdat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">logdose=</span>pdose)
pdat<span class="op">$</span>estimate &lt;-<span class="st"> </span>mlr<span class="op">$</span>family<span class="op">$</span><span class="kw">linkinv</span>(cilr<span class="op">$</span>estimate<span class="op">$</span>Estimate)
pdat<span class="op">$</span>lower &lt;-<span class="st"> </span>mlr<span class="op">$</span>family<span class="op">$</span><span class="kw">linkinv</span>(cilr<span class="op">$</span>confint<span class="op">$</span>lower)
pdat<span class="op">$</span>upper &lt;-<span class="st"> </span>mlr<span class="op">$</span>family<span class="op">$</span><span class="kw">linkinv</span>(cilr<span class="op">$</span>confint<span class="op">$</span>upper)

<span class="kw">ggplot</span>(toxinLD, <span class="kw">aes</span>(<span class="dt">x=</span>logdose, <span class="dt">y=</span>dead<span class="op">/</span>(dead<span class="op">+</span>alive))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data=</span>pdat, <span class="kw">aes</span>(<span class="dt">y=</span>estimate, <span class="dt">ymin=</span>lower, <span class="dt">ymax=</span>upper), <span class="dt">size=</span><span class="fl">0.95</span>, <span class="dt">fill=</span><span class="st">"lightblue"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span>pdat, <span class="kw">aes</span>(<span class="dt">y=</span>estimate), <span class="dt">size=</span><span class="fl">0.95</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Mortality rate"</span>)</code></pre></div>
<p><img src="mcprofile_files/figure-html/lrciplot-1.png" width="672"></p>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ul>
<li><p>Alessandra R. Brazzale and Anthony C. Davison. Accurate parametric inference for small samples. <em>Statistical Science</em>, <strong>23</strong>(4):465–484, 2008. <a href="doi:10.1214/08-STS273" class="uri">doi:10.1214/08-STS273</a>.</p></li>
<li><p>Torsten Hothorn, Frank Bretz, and Peter Westfall. Simultaneous inference in general parametric models. <em>Biometrical Journal</em>, <strong>50</strong>(3):346–363, 2008. <a href="doi:10.1002/bimj.200810425" class="uri">doi:10.1002/bimj.200810425</a>.</p></li>
<li><p>P. McCullagh and J.A. Nelder. <em>Generalized Linear Models</em>. Monographs on Statistics and Applied Probability. Chapman and Hall, 1989. ISBN 9780412317606.</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#an-introduction-to-the-mcprofile-package">An introduction to the mcprofile package</a><ul class="nav nav-pills nav-stacked">
<li><a href="#motivation">Motivation</a></li>
      <li><a href="#methods">Methods</a></li>
      <li><a href="#the-mcprofile-function">The mcprofile() function</a></li>
      <li><a href="#wald-type-statistics">Wald-type statistics</a></li>
      <li><a href="#modified-likelihood-root-1">Modified likelihood root</a></li>
      <li><a href="#simultaneous-confidence-intervals-for-predictions-in-logistic-regression-models">Simultaneous confidence intervals for predictions in logistic regression models</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Gerhard.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
